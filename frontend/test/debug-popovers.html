<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Popovers - FIA v3.0</title>
    
    <!-- Bootstrap 5.3.2 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="src/styles/main.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h1 class="h4 mb-0">
                            <i class="bi bi-bug-fill me-2"></i>
                            Debug Interface Introduction Popovers - FIA v3.0
                        </h1>
                    </div>
                    <div class="card-body">
                        
                        <!-- Instructions de test -->
                        <div class="alert alert-info">
                            <h5><i class="bi bi-info-circle me-2"></i>Instructions de Test</h5>
                            <ol>
                                <li>Utilisez les boutons ci-dessous pour tester le syst√®me de popovers</li>
                                <li>V√©rifiez que Bootstrap est charg√© correctement</li>
                                <li>Testez l'import dynamique du composant</li>
                                <li>Forcez l'affichage des popovers</li>
                                <li>V√©rifiez la d√©tection slide_type="plan"</li>
                            </ol>
                        </div>
                        
                        <!-- Console de debug -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h5>Tests Syst√®me</h5>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-primary" id="test-bootstrap">
                                        <i class="bi bi-check-circle me-2"></i>Tester Bootstrap
                                    </button>
                                    <button class="btn btn-outline-secondary" id="test-import">
                                        <i class="bi bi-download me-2"></i>Tester Import Composant
                                    </button>
                                    <button class="btn btn-outline-success" id="test-elements">
                                        <i class="bi bi-search me-2"></i>V√©rifier √âl√©ments Interface
                                    </button>
                                    <button class="btn btn-outline-warning" id="test-storage">
                                        <i class="bi bi-database me-2"></i>V√©rifier LocalStorage
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>Actions de Debug</h5>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" id="force-popovers">
                                        <i class="bi bi-play-fill me-2"></i>Forcer Affichage Popovers
                                    </button>
                                    <button class="btn btn-warning" id="reset-storage">
                                        <i class="bi bi-arrow-clockwise me-2"></i>Reset √âtat Introduction
                                    </button>
                                    <button class="btn btn-danger" id="hide-all-popovers">
                                        <i class="bi bi-x-circle me-2"></i>Masquer Tous Popovers
                                    </button>
                                    <button class="btn btn-info" id="simulate-plan-slide">
                                        <i class="bi bi-gear me-2"></i>Simuler Slide "Plan"
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Interface de test avec √©l√©ments du training.html -->
                        <div class="row">
                            <div class="col-12">
                                <h5>Interface de Test (√âl√©ments training.html)</h5>
                                <div class="alert alert-secondary">
                                    <p class="mb-3">Cette interface simule les √©l√©ments de training.html pour tester les popovers :</p>
                                    
                                    <!-- Elements similaires √† training.html -->
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label class="form-label">Chat Input</label>
                                            <textarea class="form-control" id="chat-input" placeholder="Ask your AI trainer..." rows="2"></textarea>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">Voice Chat</label><br>
                                            <button class="btn btn-primary" id="voice-chat-btn">
                                                <i class="bi bi-mic"></i>
                                            </button>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">Audio Toggle</label><br>
                                            <input type="checkbox" id="tts-toggle" class="form-check-input">
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">Live API</label><br>
                                            <button class="btn btn-success" id="live-api-btn">
                                                <i class="bi bi-soundwave"></i>
                                            </button>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">Navigation</label><br>
                                            <div class="btn-group">
                                                <button class="btn btn-primary" id="new-previous-btn">
                                                    <i class="bi bi-chevron-left"></i>
                                                </button>
                                                <button class="btn btn-primary" id="new-next-btn">
                                                    <i class="bi bi-chevron-right"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row g-3 mt-2">
                                        <div class="col-md-3">
                                            <button class="btn btn-outline-primary" id="new-simplify-btn">
                                                <i class="bi bi-arrows-collapse me-1"></i>Simplify
                                            </button>
                                        </div>
                                        <div class="col-md-3">
                                            <button class="btn btn-outline-primary" id="new-more-details-btn">
                                                <i class="bi bi-arrows-expand me-1"></i>Details
                                            </button>
                                        </div>
                                        <div class="col-md-3">
                                            <button class="btn btn-outline-primary" id="generate-chart-btn">
                                                <i class="bi bi-graph-up me-1"></i>Chart
                                            </button>
                                        </div>
                                        <div class="col-md-3">
                                            <button class="btn btn-outline-secondary" id="test-popover-btn">
                                                <i class="bi bi-question-circle me-1"></i>Test Popover
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Console de log -->
                        <div class="mt-4">
                            <h5>Console de Debug</h5>
                            <div class="card">
                                <div class="card-body">
                                    <pre id="debug-console" class="mb-0" style="height: 300px; overflow-y: auto; background: #f8f9fa; padding: 1rem; font-size: 0.875rem;"></pre>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-sm btn-secondary" id="clear-console">
                                        <i class="bi bi-trash me-1"></i>Clear Console
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Debug Script -->
    <script type="module">
        // Console de debug personnalis√©e
        const debugConsole = document.getElementById('debug-console');
        
        function log(message, level = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const levelIcon = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'warning': '‚ö†Ô∏è',
                'error': '‚ùå',
                'debug': 'üîç'
            }[level] || '‚ÑπÔ∏è';
            
            const logEntry = `[${timestamp}] ${levelIcon} ${message}\n`;
            debugConsole.textContent += logEntry;
            debugConsole.scrollTop = debugConsole.scrollHeight;
            
            // Log also to browser console
            console.log(`[DEBUG-POPOVERS] ${message}`);
        }
        
        // Test Bootstrap
        document.getElementById('test-bootstrap').addEventListener('click', () => {
            log('=== TEST BOOTSTRAP ===', 'debug');
            
            if (typeof bootstrap !== 'undefined') {
                log('‚úÖ Bootstrap est charg√© correctement', 'success');
                log(`üì¶ Version Bootstrap: ${bootstrap.Tooltip.VERSION || 'N/A'}`, 'info');
                
                if (bootstrap.Popover) {
                    log('‚úÖ Bootstrap.Popover est disponible', 'success');
                } else {
                    log('‚ùå Bootstrap.Popover non disponible', 'error');
                }
            } else {
                log('‚ùå Bootstrap n\'est pas charg√©', 'error');
            }
        });
        
        // Test Import Composant
        document.getElementById('test-import').addEventListener('click', async () => {
            log('=== TEST IMPORT COMPOSANT ===', 'debug');
            
            try {
                log('üîÑ Import du composant InterfaceIntroductionPopovers...', 'info');
                const { InterfaceIntroductionPopovers } = await import('./src/components/interface-introduction-popovers.js');
                
                log('‚úÖ Import r√©ussi !', 'success');
                log('üéØ Cr√©ation d\'une instance de test...', 'info');
                
                const testInstance = new InterfaceIntroductionPopovers();
                log('‚úÖ Instance cr√©√©e avec succ√®s', 'success');
                log(`üìä √âl√©ments configur√©s: ${testInstance.interfaceElements.size}`, 'info');
                
                // Test storage
                const shouldShow = testInstance.shouldShowIntroduction();
                log(`üîç shouldShowIntroduction(): ${shouldShow}`, 'info');
                
                window.testPopoverInstance = testInstance;
                log('üíæ Instance sauv√©e dans window.testPopoverInstance', 'info');
                
            } catch (error) {
                log(`‚ùå Erreur import: ${error.message}`, 'error');
                log(`üîç Stack: ${error.stack}`, 'error');
            }
        });
        
        // Test Elements Interface
        document.getElementById('test-elements').addEventListener('click', () => {
            log('=== TEST √âL√âMENTS INTERFACE ===', 'debug');
            
            const elementsToCheck = [
                'chat-input',
                'voice-chat-btn', 
                'tts-toggle',
                'live-api-btn',
                'new-next-btn',
                'new-previous-btn',
                'new-simplify-btn',
                'new-more-details-btn',
                'generate-chart-btn'
            ];
            
            let found = 0;
            elementsToCheck.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log(`‚úÖ √âl√©ment trouv√©: ${id}`, 'success');
                    found++;
                } else {
                    log(`‚ùå √âl√©ment manquant: ${id}`, 'error');
                }
            });
            
            log(`üìä R√©sultat: ${found}/${elementsToCheck.length} √©l√©ments trouv√©s`, found === elementsToCheck.length ? 'success' : 'warning');
        });
        
        // Test Storage
        document.getElementById('test-storage').addEventListener('click', () => {
            log('=== TEST LOCALSTORAGE ===', 'debug');
            
            const storageKey = 'fia_interface_intro_completed';
            const currentValue = localStorage.getItem(storageKey);
            
            log(`üîç Cl√© localStorage: ${storageKey}`, 'info');
            log(`üìä Valeur actuelle: ${currentValue || 'null'}`, 'info');
            
            if (currentValue) {
                log('‚ö†Ô∏è Introduction marqu√©e comme termin√©e', 'warning');
            } else {
                log('‚úÖ Introduction pas encore termin√©e', 'success');
            }
        });
        
        // Force Popovers
        document.getElementById('force-popovers').addEventListener('click', async () => {
            log('=== FORCER AFFICHAGE POPOVERS ===', 'debug');
            
            try {
                if (!window.testPopoverInstance) {
                    log('üîÑ Cr√©ation instance composant...', 'info');
                    const { InterfaceIntroductionPopovers } = await import('./src/components/interface-introduction-popovers.js');
                    window.testPopoverInstance = new InterfaceIntroductionPopovers();
                }
                
                log('üöÄ For√ßage affichage popovers...', 'info');
                
                // Reset storage pour forcer l'affichage
                localStorage.removeItem('fia_interface_intro_completed');
                log('üîÑ LocalStorage reset', 'info');
                
                // Show popovers
                window.testPopoverInstance.showIntroductionPopovers();
                log('‚úÖ Popovers lanc√©s !', 'success');
                
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`, 'error');
            }
        });
        
        // Reset Storage
        document.getElementById('reset-storage').addEventListener('click', () => {
            log('=== RESET STORAGE ===', 'debug');
            localStorage.removeItem('fia_interface_intro_completed');
            log('‚úÖ √âtat introduction reset', 'success');
        });
        
        // Hide All Popovers
        document.getElementById('hide-all-popovers').addEventListener('click', () => {
            log('=== MASQUER POPOVERS ===', 'debug');
            
            if (window.testPopoverInstance) {
                window.testPopoverInstance.hideAllPopovers();
                log('‚úÖ Tous les popovers masqu√©s', 'success');
            } else {
                log('‚ö†Ô∏è Aucune instance de popover active', 'warning');
            }
        });
        
        // Simulate Plan Slide
        document.getElementById('simulate-plan-slide').addEventListener('click', async () => {
            log('=== SIMULATION SLIDE "PLAN" ===', 'debug');
            
            try {
                // Import du slide content manager
                log('üîÑ Import SlideContentManager...', 'info');
                const { SlideContentManager } = await import('./src/components/slide-content-manager.js');
                
                const manager = new SlideContentManager();
                log('‚úÖ SlideContentManager cr√©√©', 'success');
                
                // Simuler slideData avec slide_type = "plan"
                const mockSlideData = {
                    slide_type: 'plan',
                    title: 'Plan de Formation Test',
                    slide_content: '# Plan de Formation\\n\\nCeci est un test pour d√©clencher les popovers d\'introduction.'
                };
                
                log('üéØ Simulation checkAndTriggerInterfaceIntroduction...', 'info');
                log(`üìä Mock slideData: ${JSON.stringify(mockSlideData)}`, 'debug');
                
                // D√©clencher la v√©rification
                manager.checkAndTriggerInterfaceIntroduction(mockSlideData);
                
                log('‚úÖ Simulation d√©clench√©e !', 'success');
                log('‚è∞ Attendre 1 seconde pour l\'import et l\'affichage...', 'info');
                
            } catch (error) {
                log(`‚ùå Erreur simulation: ${error.message}`, 'error');
            }
        });
        
        // Test popover simple
        document.getElementById('test-popover-btn').addEventListener('click', () => {
            log('=== TEST POPOVER SIMPLE ===', 'debug');
            
            if (typeof bootstrap !== 'undefined' && bootstrap.Popover) {
                const testBtn = document.getElementById('test-popover-btn');
                
                // Cr√©er un popover simple de test
                const testPopover = new bootstrap.Popover(testBtn, {
                    title: 'Test Popover',
                    content: 'Ce popover fonctionne !',
                    placement: 'top',
                    trigger: 'manual'
                });
                
                testPopover.show();
                log('‚úÖ Popover de test affich√©', 'success');
                
                // Masquer apr√®s 3 secondes
                setTimeout(() => {
                    testPopover.hide();
                    log('üîÑ Popover de test masqu√©', 'info');
                }, 3000);
                
            } else {
                log('‚ùå Bootstrap.Popover non disponible', 'error');
            }
        });
        
        // Clear Console
        document.getElementById('clear-console').addEventListener('click', () => {
            debugConsole.textContent = '';
        });
        
        // Init log
        log('üöÄ Debug Interface Popovers - Pr√™t !', 'success');
        log('üí° Utilisez les boutons ci-dessus pour tester le syst√®me', 'info');
        
    </script>
</body>
</html>